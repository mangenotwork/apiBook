{{ define "pubjs" }}
<script type="text/javascript" src="/js/jquery.min.js?v={{ .TimeStamp }}"></script>
<script type="text/javascript" src="/js/bootstrap.bundle.min.js?v={{ .TimeStamp }}"></script>
<script type="text/javascript" src="/js/bootstrap-select.min.js?v={{ .TimeStamp }}"></script>
<script type="text/javascript" src="/js/popper.min.js?v={{ .TimeStamp }}"></script>
<script type="text/javascript" src="/js/tippy-bundle.umd.min.js?v={{ .TimeStamp }}"></script>
<script type="text/javascript" src="/js/jsoneditor.js?v={{ .TimeStamp }}"></script>
<script type="text/javascript" src="/js/editormd.min.js?v={{ .TimeStamp }}"></script>
<script type="text/javascript" src="/js/rainbow.min.js?v={{ .TimeStamp }}"></script>
<script>

    function tippyInit() {
        tippy('.shareButton', {
            content: '分享接口文档',
        });
        tippy('.changeButton', {
            content: '切换项目',
        });
        tippy('.addDirButton', {
            content: "新建目录",
        });
        tippy('.addDocButton', {
            content: "新建文档",
        });
        tippy('.pConfButton', {
            content: "项目设置",
        });
        tippy('.sortDirButton', {
            content: "目录排序",
        })
        tippy('.moveDocButton', {
            content: "移动至其他目录",
        })
        tippy('.editDocButton', {
            content: "编辑文档",
        })
        tippy('.globalCodeButton', {
            content: "全局code",
        })
        tippy('.globalHeaderButton', {
            content: "全局header",
        })
        tippy('.recycleBinButton', {
            content: "移动至回收站",
        })
        tippy('.deleteButton', {
            content: "删除文档",
        })
        tippy('.delDirButton', {
            content: "删除目录",
        })
        tippy('.sortDocButton', {
            content: "文档排序",
        })
        tippy('.copyUrlButton', {
            content: "复制url",
        })
    }

    tippy('#openBodyBtn-go',{
        content: "golang结构体转换参数说明",
    });
    tippy('#openBodyBtn-ts',{
        content: "ts接口转换参数说明",
    });
    tippy('#openRespBtn-go',{
        content: "golang结构体转换参数说明",
    });
    tippy('#openRespBtn-ts',{
        content: "ts接口转换参数说明",
    });

    const dirDev = function (dirid, name) {
        var isOpen = 'style="display: none;"'
        var dirIcon = '{{ SVG "folder" 21 21 }}'
        var open = 0
        if (localStorage.getItem(dirOpenKey+dirid) === "1") {
            isOpen = 'style="display: inline;"'
            dirIcon = '{{ SVG "folder2-open" 21 21 }}'
            open = 1
        }

        var isDelBtn = '';
        if (!dirid.includes("default_") && !dirid.includes("recycleBin_")) {
            isDelBtn = '<button type="button" class="btn btn-outline-dark delDirButton" onclick="delDir(\''+dirid+'\')">{{ SVG "folder-x" 12 12 }}</button>\n'
        }

        var op = '';
        if (!dirid.includes("recycleBin_")) {
            op = '<button type="button" class="btn btn-outline-dark sortDocButton" onclick="sortDoc(\''+dirid+'\')">{{ SVG "list-ol" 12 12 }}</button>\n' +
                '<button type="button" class="btn btn-outline-dark addDocButton" onclick="newAPIDoc(\''+dirid+'\')">{{ SVG "plus-lg" 12 12 }}</button>\n'
        }

        return '<div class="dir">\n' +
            '<b><p class="dir-open" data-open="'+open+'" data-dirid="'+dirid+'"><span style="margin-right: 8px;">'+dirIcon+'</span>'+name+'</p></b>' +
            '<div class="btn-group btn-group-sm dirop" role="group" aria-label="Small button group">\n' +
            isDelBtn + op +
            '</div>\n' +
            '</div>' +
            '<ul id="'+dirid+'" '+isOpen+'>' +
            '</ul>'
    }


    const docLi = function (id, method, name) {
        var methodtxt = ""
        switch (method) {
            case "GET":methodtxt = GETSpan;break;
            case "DELETE":methodtxt = DELETESpan;break;
            case "POST":methodtxt = POSTSpan;break;
            case "HEAD":methodtxt = HEADSpan;break;
            case "PUT":methodtxt = PUTSpan;break;
            case "OPTIONS":methodtxt = OPTIONSSpan;break;
        }
        return '<li class="hover-area docli" style="height: 52px;" id="'+id+'">\n' +
            '                <p>'+methodtxt+name+'</p>\n' +
            // '                <div class="btn-group btn-group-sm action-btn docliop" role="group" aria-label="Small button group">\n' +
            // '                    <button type="button" class="btn btn-outline-dark moveDocButton moveDoc" data-docId="'+id+'">{{ SVG "arrows-move" 16 16 }}</button>\n' +
            // '                    <button type="button" class="btn btn-outline-dark editDocButton">{{ SVG "pencil-square" 16 16 }}</button>\n' +
            // '                    <button type="button" class="btn btn-outline-dark shareButton docShare" data-docId="'+id+'">{{ SVG "share-fill" 16 16 }}</button>\n' +
            // '                </div>\n' +
            '            </li>'
    }

    const docLiSearch = function (id, method, name, modType, word) {
        var methodtxt = ""
        switch (method) {
            case "GET":methodtxt = GETSpan;break;
            case "DELETE":methodtxt = DELETESpan;break;
            case "POST":methodtxt = POSTSpan;break;
            case "HEAD":methodtxt = HEADSpan;break;
            case "PUT":methodtxt = PUTSpan;break;
            case "OPTIONS":methodtxt = OPTIONSSpan;break;
        }
        return '<li class="hover-area docli " style="border-bottom: 1px solid rgba(0,0,0,0.32);height: 52px;margin-bottom: 8px;" id="'+id+'">\n' +
            '                <p style="margin: 0px;">'+methodtxt+name+'</p>\n' +
            '<span style="font-size: 12px;margin-top: -4px;">在'+modType+'匹配到关键词: '+word+'</span>'+
            '            </li>'
    }

    const addDocDirOption = function (dirId, dirName) {
        return '<option value="' + dirId + '">' + dirName + '</option>'
    }

    const apiReqHeaderTpl = function (field, varType, isRequired, description, example) {

        var  isRequiredTxt = "否"
        if (isRequired === 1 ) {
            isRequiredTxt = "是"
        }

        if (varType === "") {
            varType = "-"
        }

        return '<tr>\n' +
            '<td>'+field+'</td>\n' +
            '<td>'+varType+'</td>\n' +
            '<td>'+isRequiredTxt+'</td>\n' +
            '<td>'+description+'</td>\n' +
            '<td class="ellipsis-cell">'+example+'</td>\n' +
            '</tr>'
    }

    const apiReqBodyInfoTpl = function (field, varType, isRequired, description, example, i) {
        var isRequiredTxt = "-"
        if (isRequired === 1) {
            isRequiredTxt = "必填"
        }

        return '<tr>\n' +
            '<td>'+field+'</td>\n' +
            '<td>'+varType+'</td>\n' +
            '<td>'+isRequiredTxt+'</td>\n' +
            '<td class="reqDescriptionTxt'+i+'">'+description+'</td>\n' +
            '<td class="reqExampleTxt'+i+' ellipsis-cell" style="white-space: nowrap;">'+example+'</td>\n' +
            '</tr>'
    }

    const apiRespBodyInfoTpl = function (field, varType, description, example, i) {


        return '<tr>\n' +
            '<td>'+field+'</td>\n' +
            '<td>'+varType+'</td>\n' +
            '<td class="respDescriptionTxt'+i+'">'+description+'</td>\n' +
            '<td class="respExampleTxt'+i+' ellipsis-cell" style="white-space: nowrap;">'+example+'</td>\n' +
            '</tr>'
    }

    function fieldTypeOption(fieldType) {
        var stringTypeVal = '<option value="string">String</option>'
        var numberTypeVal = '<option value="number">Number</option>'
        var booleanTypeVal = '<option value="boolean">Boolean</option>'
        var arrayTypeVal = '<option value="array">Array</option>'
        var objectTypeVal = '<option value="object">Object</option>'
        switch (fieldType){
            case "string":
                stringTypeVal = '<option value="string" selected>String</option>'
                break
            case "number":
                numberTypeVal = '<option value="number" selected>Number</option>'
                break
            case "boolean":
                booleanTypeVal = '<option value="boolean" selected>Boolean</option>'
                break
            case "array":
                arrayTypeVal = '<option value="array" selected>Array</option>'
                break
            case "object":
                objectTypeVal = '<option value="object" selected>Object</option>'
                break
        }
        return stringTypeVal+numberTypeVal+booleanTypeVal+arrayTypeVal+objectTypeVal
    }

    function initHeaderAdd() {
        var tpl = '<tr>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <select class="form-select form-select-sm addDocHeaderIsRequired" style="font-size: 11px;">\n' +
            '                                                  <option value="1">必填</option>\n' +
            '                                                  <option value="0">非必填</option>\n' +
            '                                              </select>\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm addDocHeaderField" type="text" placeholder="字段" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm addDocHeaderDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <select class="form-select form-select-sm addDocHeaderVarType" style="font-size: 11px;">\n' +
            '                                                  <option value="">类型</option>\n' +
            '                                                  <option value="String">String</option>\n' +
            '                                                  <option value="Number">Number</option>\n' +
            '                                                  <option value="Integer">Integer</option>\n' +
            '                                                  <option value="Float">Float</option>\n' +
            '                                                  <option value="Double">Double</option>\n' +
            '                                                  <option value="Bool">Bool</option>\n' +
            '                                                  <option value="Array">Array</option>\n' +
            '                                                  <option value="Object">Object</option>\n' +
            '                                              </select>\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%">\n' +
            '                                              <input class="form-control form-control-sm addDocHeaderExample" type="text" placeholder="示例" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <div class="btn-group btn-group-sm" role="group">\n' +
            '                                                  <a type="button" class="btn btn-outline-dark btn-sm headerAdd" data-bs-toggle="tooltip" data-bs-title="增加行" >{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                              </div>\n' +
            '                                          </td>\n' +
            '                                      </tr>'
        return tpl
    }

    $(document).on('click', '.headerAdd', function() {
        var tpl = '<tr>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <select class="form-select form-select-sm addDocHeaderIsRequired" style="font-size: 11px;">'+
            '                                       <option value="1">必填</option>'+
            '                                       <option value="0">非必填</option>'+
            '                                   </select>'+
            '                                </td>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderField" type="text" placeholder="字段" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <select class="form-select form-select-sm addDocHeaderVarType" style="font-size: 11px;">\n' +
            '                                        <option value="">类型</option>\n' +
            '                                        <option value="String">String</option>\n' +
            '                                        <option value="Number">Number</option>\n' +
            '                                        <option value="Integer">Integer</option>\n' +
            '                                        <option value="Float">Float</option>\n' +
            '                                        <option value="Double">Double</option>\n' +
            '                                        <option value="Bool">Bool</option>\n' +
            '                                        <option value="Array">Array</option>\n' +
            '                                        <option value="Object">Object</option>\n' +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderExample" type="text" placeholder="示例" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <div class="btn-group btn-group-sm" role="group">\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm headerAdd" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm headerRemove" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                                    </div>\n' +
            '                                </td>\n' +
            '                            </tr>'

        $("#setHeaderTable").append(tpl);
    });

    function headerAddTpl(field, isRequired, varType, description, example) {
        var fieldVal = ""
        if (field !== "") {
            fieldVal  = 'value="'+field+'"'
        }

        var isRequiredVal = ""
        if (isRequired !== "") {
            isRequiredVal = 'value="'+isRequiredVal+'"'
        }

        var descriptionVal = ""
        if (description !== "") {
            descriptionVal = 'value="'+description+'"'
        }

        var exampleVal = ""
        if (example !== "") {
            exampleVal = 'value="'+example+'"'
        }

        var tpl = '<tr>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <select class="form-select form-select-sm addDocHeaderIsRequired" '+isRequiredVal+' style="font-size: 11px;">'+
            '                                       <option value="1">必填</option>'+
            '                                       <option value="0">非必填</option>'+
            '                                   </select>'+
            '                                </td>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderField" type="text" '+fieldVal+' placeholder="字段" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderDescription" type="text" '+descriptionVal+' placeholder="描述" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <select class="form-select form-select-sm addDocHeaderVarType" style="font-size: 11px;">\n' +
            '                                        <option value="">类型</option>\n' +fieldTypeOption(varType) +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderExample" type="text" '+exampleVal+' placeholder="示例" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <div class="btn-group btn-group-sm" role="group">\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm headerAdd" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm headerRemove" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                                    </div>\n' +
            '                                </td>\n' +
            '                            </tr>'
        return tpl
    }

    function initAddReqTpl() {
        var tpl = '<tr>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm reqField" type="text" placeholder="字段" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm reqDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%">\n' +
            '                                              <select class="form-select form-select-sm reqVarType" style="font-size: 11px;">\n' +
            '                                                  <option value="">类型</option>\n' +
            '                                                  <option value="string">String</option>\n' +
            '                                                  <option value="number">Number</option>\n' +
            '                                                  <option value="boolean">Boolean</option>\n' +
            '                                                  <option value="array">Array</option>\n' +
            '                                                  <option value="object">Object</option>\n' +
            '                                                  <option value="file">File</option>\n' +
            '                                              </select>\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm reqExample" type="text" placeholder="示例" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <select class="form-select form-select-sm reqIsRequired" style="font-size: 11px;">\n' +
            '                                                  <option value="1">不为空</option>\n' +
            '                                                  <option value="0">可为空</option>\n' +
            '                                              </select>\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <div class="btn-group btn-group-sm" role="group">\n' +
            '                                                  <a type="button" class="btn btn-outline-dark btn-sm addReq" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                              </div>\n' +
            '                                          </td>\n' +
            '                                      </tr>'
        return tpl
    }

    function addReqTpl(field, fieldType, example, description, reqIsRequired) {
        var fieldVal = ""
        if (field !== "") {
            fieldVal  = 'value="'+field+'"'
        }

        var descriptionVal = ""
        if (description !== "") {
            descriptionVal = 'value="'+description+'"'
        }

        var reqIsRequiredVal = ""
        if (reqIsRequired !== "") {
            reqIsRequiredVal = 'value="'+reqIsRequired+'"'
        }

        var reqExample = ""
        if (fieldType === "string") {
            example = removeHtmlTags(example)
        }
        if (example !== "") {
            reqExample = 'value="'+example+'"'
        }

        var tpl = '<tr>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm reqField" type="text" placeholder="字段" '+ fieldVal +' style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 25%;">\n' +
            '                                    <input class="form-control form-control-sm reqDescription" type="text" placeholder="描述" '+ descriptionVal +' style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%">\n' +
            '                                    <select class="form-select form-select-sm reqVarType" style="font-size: 11px;">\n' +
            '                                        <option value="">类型</option>\n' + fieldTypeOption(fieldType) +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%;">'+
            '                                   <input class="form-control form-control-sm reqExample" type="text" placeholder="示例" '+ reqExample +' style="font-size: 11px;">'+
            '                                </td>'+
            '                                <td style="width: 10%;">\n' +
            '                                    <select class="form-select form-select-sm reqIsRequired" '+ reqIsRequiredVal +' style="font-size: 11px;">\n' +
            '                                        <option value="1">不为空</option>\n' +
            '                                        <option value="0">可为空</option>\n' +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <div class="btn-group btn-group-sm" role="group">\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm addReq" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm removeReq" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                                    </div>\n' +
            '                                </td>\n' +
            '                            </tr>';

        return tpl
    }

    function delReqTpl() {
        $("#setReqTable").empty();
        $("#setReqTable").append('<tr>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm reqField" type="text" placeholder="字段" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm reqDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%">\n' +
            '                                              <select class="form-select form-select-sm reqVarType" style="font-size: 11px;">\n' +
            '                                                  <option value="">类型</option>\n' +
            '                                                  <option value="string">String</option>\n' +
            '                                                  <option value="number">Number</option>\n' +
            '                                                  <option value="boolean">Boolean</option>\n' +
            '                                                  <option value="array">Array</option>\n' +
            '                                                  <option value="object">Object</option>\n' +
            '                                                  <option value="file">File</option>\n' +
            '                                              </select>\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm reqExample" type="text" placeholder="示例" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <select class="form-select form-select-sm reqIsRequired" style="font-size: 11px;">\n' +
            '                                                  <option value="1">不为空</option>\n' +
            '                                                  <option value="0">可为空</option>\n' +
            '                                              </select>\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <div class="btn-group btn-group-sm" role="group">\n' +
            '                                                  <a type="button" class="btn btn-outline-dark btn-sm addReq" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                              </div>\n' +
            '                                          </td>\n' +
            '                                      </tr>');
    }

    function initAddRespTpl() {
        var tpl = '<tr>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm respField" type="text" placeholder="字段" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm respDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%">\n' +
            '                                              <select class="form-select form-select-sm respVarType" style="font-size: 11px;">\n' +
            '                                                  <option value="">类型</option>\n' +
            '                                                  <option value="string">String</option>\n' +
            '                                                  <option value="number">Number</option>\n' +
            '                                                  <option value="boolean">Boolean</option>\n' +
            '                                                  <option value="array">Array</option>\n' +
            '                                                  <option value="object">Object</option>\n' +
            '                                                  <option value="file">File</option>\n' +
            '                                              </select>\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%">\n' +
            '                                              <input class="form-control form-control-sm respExample" type="text" placeholder="返回值" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <div class="btn-group btn-group-sm" role="group">\n' +
            '                                                  <a type="button" class="btn btn-outline-dark btn-sm addResp" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                              </div>\n' +
            '                                          </td>\n' +
            '                                      </tr>'
        return tpl
    }

    function addRespTpl(field, fieldType, example, description) {
        var fieldVal = ""
        if (field !== "") {
            fieldVal  = 'value="'+field+'"'
        }

        var descriptionVal = ""
        if (description !== "") {
            descriptionVal = 'value="'+description+'"'
        }

        var stringTypeVal = '<option value="string">String</option>'
        var numberTypeVal = '<option value="number">Number</option>'
        var booleanTypeVal = '<option value="boolean">Boolean</option>'
        var arrayTypeVal = '<option value="array">Array</option>'
        var objectTypeVal = '<option value="object">Object</option>'


        switch (fieldType){
            case "string":
                stringTypeVal = '<option value="string" selected>String</option>'
                break
            case "number":
                numberTypeVal = '<option value="number" selected>Number</option>'
                break
            case "boolean":
                booleanTypeVal = '<option value="boolean" selected>Boolean</option>'
                break
            case "array":
                arrayTypeVal = '<option value="array" selected>Array</option>'
                break
            case "object":
                objectTypeVal = '<option value="object" selected>Object</option>'
                break
        }

        var reqExample = ""
        if (fieldType === "string") {
            example = removeHtmlTags(example)
        }
        if (example !== "") {
            reqExample = 'value="'+example+'"'
        }

        var tpl = '<tr>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm respField" type="text" placeholder="字段" '+ fieldVal +' style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm respDescription" type="text" placeholder="描述" '+ descriptionVal +' style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%">\n' +
            '                                    <select class="form-select form-select-sm respVarType" style="font-size: 11px;">\n' +
            '                                        <option value="">类型</option>\n' + stringTypeVal + numberTypeVal + booleanTypeVal + arrayTypeVal + objectTypeVal +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%">\n' +
            '                                    <input class="form-control form-control-sm respExample" type="text" placeholder="返回值" '+ reqExample +' style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <div class="btn-group btn-group-sm" role="group">\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm addResp" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm removeResp" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                                    </div>\n' +
            '                                </td>\n' +
            '                            </tr>'

        return tpl
    }

    function delRespTpl() {
        $("#setRespTable").empty();
        $("#setRespTable").append('<tr>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm respField" type="text" placeholder="字段" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%;">\n' +
            '                                              <input class="form-control form-control-sm respDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%">\n' +
            '                                              <select class="form-select form-select-sm respVarType" style="font-size: 11px;">\n' +
            '                                                  <option value="">类型</option>\n' +
            '                                                  <option value="string">String</option>\n' +
            '                                                  <option value="number">Number</option>\n' +
            '                                                  <option value="boolean">Boolean</option>\n' +
            '                                                  <option value="array">Array</option>\n' +
            '                                                  <option value="object">Object</option>\n' +
            '                                                  <option value="file">File</option>\n' +
            '                                              </select>\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 20%">\n' +
            '                                              <input class="form-control form-control-sm respExample" type="text" placeholder="返回值" style="font-size: 11px;">\n' +
            '                                          </td>\n' +
            '                                          <td style="width: 10%;">\n' +
            '                                              <div class="btn-group btn-group-sm" role="group">\n' +
            '                                                  <a type="button" class="btn btn-outline-dark btn-sm addResp" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                              </div>\n' +
            '                                          </td>\n' +
            '                                      </tr>')
    }

    function docViewItemTpl(isActiveStr, docId, apiMethod, apiName) {
        return '<li class="nav-item" >\n' +
        '<a class="nav-link docViewItem ' + isActiveStr + '" data-docid="' + docId +
            '" aria-current="page" style="height: 36px;" href="#"><p style="width: 150px;float: left;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">[' + apiMethod +
            ']' + apiName + '</p> <span class="docViewClose" style="float: left;">{{ SVG "x-square-fill" 16 16 }}</span></a>\n' +
        '</li>'
    }

    const GETSpan = '<span class="badge rounded-pill text-bg-success">GET</span>'
    const DELETESpan = '<span class="badge rounded-pill text-bg-danger">DELETE</span>'
    const POSTSpan = '<span class="badge rounded-pill text-bg-info">POST</span>'
    const HEADSpan = '<span class="badge rounded-pill text-bg-dark">HEAD</span>'
    const PUTSpan = '<span class="badge rounded-pill text-bg-secondary">PUT</span>'
    const OPTIONSSpan = '<span class="badge rounded-pill text-bg-light">OPTIONS</span>'


    function initGlobalCodeTpl() {
        var tpl = '<tr>\n' +
            '                        <td style="width: 20%;">\n' +
            '                            <input class="form-control form-control-sm globalCodeKey" type="text" placeholder="状态值" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 20%">\n' +
            '                            <input class="form-control form-control-sm globalCodeDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 10%;">\n' +
            '                            <div class="btn-group btn-group-sm" role="group">\n' +
            '                                <a type="button" class="btn btn-outline-dark btn-sm globalCodeAdd" data-bs-toggle="tooltip" data-bs-title="增加行" >{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                            </div>\n' +
            '                        </td>\n' +
            '                    </tr>'
        return tpl
    }

    function addGlobalCodeTpl(codeKey, codeDescription) {
        var codeKeyVal = ""
        var codeDescriptionVal = ""

        if (codeKey !== "") {
            codeKeyVal  = 'value="'+codeKey+'"'
        }

        if (codeDescription !== "") {
            codeDescriptionVal = 'value="'+codeDescription+'"'
        }

        var tpl = '<tr>\n' +
            '                        <td style="width: 20%;">\n' +
            '                            <input class="form-control form-control-sm globalCodeKey" type="text" '+codeKeyVal+' placeholder="状态值" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 20%">\n' +
            '                            <input class="form-control form-control-sm globalCodeDescription" type="text" '+codeDescriptionVal+' placeholder="描述" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 10%;">\n' +
            '                            <div class="btn-group btn-group-sm" role="group">\n' +
            '                                <a type="button" class="btn btn-outline-dark btn-sm globalCodeAdd" data-bs-toggle="tooltip" data-bs-title="增加行" >{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                <a type="button" class="btn btn-outline-dark btn-sm globalCodeRemove" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                            </div>\n' +
            '                        </td>\n' +
            '                    </tr>'
        return tpl
    }

    function initGlobalHeaderAddTpl() {
        var tpl = '<tr>\n' +
            '                        <td style="width: 10%;">\n' +
            '                            <select class="form-select form-select-sm globalHeaderIsRequired" style="font-size: 11px;">\n' +
            '                                <option value="1">必填</option>\n' +
            '                                <option value="0">非必填</option>\n' +
            '                            </select>\n' +
            '                        </td>\n' +
            '                        <td style="width: 20%;">\n' +
            '                            <input class="form-control form-control-sm globalHeaderField" type="text" placeholder="字段" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 20%;">\n' +
            '                            <input class="form-control form-control-sm globalHeaderDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 10%;">\n' +
            '                            <select class="form-select form-select-sm globalHeaderVarType" style="font-size: 11px;">\n' +
            '                                <option value="">类型</option>\n' +
            '                                <option value="String">String</option>\n' +
            '                                <option value="Number">Number</option>\n' +
            '                                <option value="Integer">Integer</option>\n' +
            '                                <option value="Float">Float</option>\n' +
            '                                <option value="Double">Double</option>\n' +
            '                                <option value="Bool">Bool</option>\n' +
            '                                <option value="Array">Array</option>\n' +
            '                                <option value="Object">Object</option>\n' +
            '                            </select>\n' +
            '                        </td>\n' +
            '                        <td style="width: 20%">\n' +
            '                            <input class="form-control form-control-sm globalHeaderExample" type="text" placeholder="示例" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 10%;">\n' +
            '                            <div class="btn-group btn-group-sm" role="group">\n' +
            '                                <a type="button" class="btn btn-outline-dark btn-sm globalHeaderAdd" data-bs-toggle="tooltip" data-bs-title="增加行" >{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                            </div>\n' +
            '                        </td>\n' +
            '                    </tr>'
        return tpl
    }

    function addGlobalHeaderAddTpl(isRequired, field, description, varType, example) {
        var globalHeaderIsRequiredVal = ""
        var globalHeaderFieldVal = ""
        var globalHeaderDescriptionVal = ""
        var globalHeaderVarTypeVal = ""
        var globalHeaderExampleVal = ""

        if (isRequired !== "") {
            globalHeaderIsRequiredVal  = 'value="'+isRequired+'"'
        }
        if (field !== "") {
            globalHeaderFieldVal  = 'value="'+field+'"'
        }
        if (description !== "") {
            globalHeaderDescriptionVal  = 'value="'+description+'"'
        }
        if (varType !== "") {
            globalHeaderVarTypeVal  = 'value="'+varType+'"'
        }
        if (example !== "") {
            globalHeaderExampleVal  = 'value="'+example+'"'
        }

        var tpl = '<tr>\n' +
            '                        <td style="width: 10%;">\n' +
            '                            <select class="form-select form-select-sm globalHeaderIsRequired" '+globalHeaderIsRequiredVal+' style="font-size: 11px;">\n' +
            '                                <option value="1">必填</option>\n' +
            '                                <option value="0">非必填</option>\n' +
            '                            </select>\n' +
            '                        </td>\n' +
            '                        <td style="width: 20%;">\n' +
            '                            <input class="form-control form-control-sm globalHeaderField" type="text" '+globalHeaderFieldVal+' placeholder="字段" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 20%;">\n' +
            '                            <input class="form-control form-control-sm globalHeaderDescription" type="text" '+globalHeaderDescriptionVal+' placeholder="描述" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 10%;">\n' +
            '                            <select class="form-select form-select-sm globalHeaderVarType" '+globalHeaderVarTypeVal+' style="font-size: 11px;">\n' +
            '                                <option value="">类型</option>\n' +
            '                                <option value="String">String</option>\n' +
            '                                <option value="Number">Number</option>\n' +
            '                                <option value="Integer">Integer</option>\n' +
            '                                <option value="Float">Float</option>\n' +
            '                                <option value="Double">Double</option>\n' +
            '                                <option value="Bool">Bool</option>\n' +
            '                                <option value="Array">Array</option>\n' +
            '                                <option value="Object">Object</option>\n' +
            '                            </select>\n' +
            '                        </td>\n' +
            '                        <td style="width: 20%">\n' +
            '                            <input class="form-control form-control-sm globalHeaderExample" type="text" '+globalHeaderExampleVal+' placeholder="示例" style="font-size: 11px;">\n' +
            '                        </td>\n' +
            '                        <td style="width: 10%;">\n' +
            '                            <div class="btn-group btn-group-sm" role="group">\n' +
            '                                <a type="button" class="btn btn-outline-dark btn-sm globalHeaderAdd" data-bs-toggle="tooltip" data-bs-title="增加行" >{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                <a type="button" class="btn btn-outline-dark btn-sm globalHeaderRemove" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                            </div>\n' +
            '                        </td>\n' +
            '                    </tr>'
        return tpl

    }


    function openImport() {
        $('#importModal').modal('show');
    }

    // 选择导入方式-选择项目显示项目列表
    const radioButtons = document.getElementsByName('manner');
    for (const radioButton of radioButtons) {
        radioButton.addEventListener('change', function () {
            var importSelectProject = $("#importSelectProject");
            var importSelectProjectVal = $("#importSelectProjectVal");

            if (this.value === "oldProject") {
                AjaxGetNotAsync("/project/list", function (data) {
                    if (data.code === 0) {
                        importSelectProjectVal.empty();
                        for (var i=0; i<data.data.length; i++){
                            var item = data.data[i];
                            importSelectProjectVal.append('<option value="'+item.projectId+'">'+item.name+' （简介:'+item.description+'） '+'</option>');
                        }
                    } else {
                        ToastShow(data.msg);
                    }
                })
                importSelectProject.show();
            }else {
                importSelectProject.hide();
            }
        });
    }

    function submitImport() {

        $("#importSubmitBtn").prop('disabled', true);

        var importType = $('input[name="importType"]:checked').val();
        var sourcePlatform = $('input[name="sourcePlatform"]:checked').val();
        var manner = $('input[name="manner"]:checked').val();
        var project = $("#importSelectProjectVal").val();
        var fileInput = $('#importFile')[0];
        var files = fileInput.files;

        if (manner === "newProject") {
            project = ""
        }

        var formData = new FormData();
        formData.append("importType", importType)
        formData.append("sourcePlatform", sourcePlatform)
        formData.append("manner", manner)
        formData.append("project", project)
        formData.append("files", files)

        if (!files[0]) {
            ToastShow("请上传导入文件");
            return
        }

        formData.append('files', files[0])


        var submitImportLoading = $("#submitImportLoading")
        submitImportLoading.show();

        $.ajax({
            type:'POST',
            url:"/tool/import",
            data:formData,
            processData: false,//不操作数据
            cache:false,//不存缓存
            contentType: false,//格式默认
            mimeType:"multipart/form-data",
            success:function (data) {
                console.log(data)

                var dataObj = JSON.parse(data);

                ToastShow(dataObj.msg);

                submitImportLoading.hide();

                // setTimeout(function() {
                //     window.location.href = "/home";
                // }, 3000);

                $("#importSubmitBtn").prop('disabled', false);

            },
            error: function(xhr,textStatus) {
                console.log(xhr, textStatus);
                submitImportLoading.hide();
                ToastShow(xhr, textStatus);

                $("#importSubmitBtn").prop('disabled', false);

            }
        });

    }

    function openExport() {

        var exportSelectProjectVal = $("#exportSelectProjectVal");

        AjaxGetNotAsync("/project/list", function (data) {
            if (data.code === 0) {
                exportSelectProjectVal.empty();
                for (var i=0; i<data.data.length; i++){
                    var item = data.data[i];
                    exportSelectProjectVal.append('<option value="'+item.projectId+'">'+item.name+' （简介:'+item.description+'） '+'</option>');
                }
            } else {
                ToastShow(data.msg);
            }
        })


        $('#exportModal').modal('show');

    }


    const exportTypeButtons = document.getElementsByName('exportType');
    for (const radioButton of exportTypeButtons) {
        radioButton.addEventListener('change', function () {
            var exportJsonType = $("#exportJsonType");
            if (this.value === "json") {
                exportJsonType.show();
            }else {
                exportJsonType.hide();
            }
        });
    }

    function submitExport() {
        var project = $("#exportSelectProjectVal").val();
        var exportType = $('input[name="exportType"]:checked').val();
        var sourcePlatform = $('input[name="sourcePlatform"]:checked').val();
        if (exportType !== "json") {
            sourcePlatform = ""
        }

        var param = {
            "project": project,
            "exportType": exportType,
            "sourcePlatform": sourcePlatform
        }

        if (project === null || project === undefined || project.length < 1 ) {
            ToastShow("请选择需要导出的项目");
            return
        }

        var xhr = new XMLHttpRequest()
        xhr.open('POST', "/tool/export", true)
        xhr.setRequestHeader("Content-Type", "application/json")
        xhr.responseType = 'blob'
        xhr.send(JSON.stringify(param))
        xhr.onload = function () {
            if (this.status===200) {
                var type = xhr.getResponseHeader('Content-Type')
                var fileName = unicodeToChinese(xhr.getResponseHeader('content-disposition'))
                console.log(fileName)

                var blob = new Blob([this.response], { type: type })
                if (typeof window.navigator.msSaveBlob !== 'undefined') {
                    window.navigator.msSaveBlob(blob, fileName)
                } else {
                    var URL = window.URL || window.webkitURL
                    var objectUrl = URL.createObjectURL(blob)
                    if (fileName) {
                        var a = document.createElement('a')
                        if (typeof a.download === 'undefined') {
                            window.location = objectUrl
                        } else {
                            a.href = objectUrl
                            a.download = fileName
                            document.body.appendChild(a)
                            a.click()
                            a.remove()
                        }
                    } else {
                        window.location = objectUrl
                    }
                    window.URL.revokeObjectURL(objectUrl);
                }
            }
        }
    }

    function unicodeToChinese(unicodeStr) {
        let result = '';
        let unicodeRegex = /\\u([\dA-Fa-f]{4})/g;
        result = unicodeStr.replace(unicodeRegex, function(match, grp) {
            return String.fromCharCode(parseInt(grp, 16));
        });
        return result;
    }

</script>
<script type="text/javascript" src="/js/pub.js?v={{ .TimeStamp }}"></script>
{{ end }}