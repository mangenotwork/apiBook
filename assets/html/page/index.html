{{ template "head" . }}
<body>
{{ template "header" . }}

<div class="container-fluid">
    <div class="row">

    {{ template "api_dir" . }}

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" style="background-color: #ffffff;">
        
        <div class="box" style="margin-top: 8px;border: 1px solid #D3D3D3; border-radius: 4px;">
            <ul class="nav nav-tabs" id="docViewTable" style="width: 100%;height:54px;flex-direction: row;flex-wrap: nowrap;overflow-x: scroll;font-size: 11px;">
                <li class="nav-item" >
                <a class="nav-link docViewItem active" aria-current="page" href="#">[Get] xxxxxxxxxxxx <span class="docViewClose">{{ SVG "x-square-fill" 16 16 }}</span></a>
                </li>
                <li class="nav-item" >
                    <a class="nav-link docViewItem" aria-current="page" href="#">[Get] xxxxxxxxxxxx <span class="docViewClose">{{ SVG "x-square-fill" 16 16 }}</span></a>
                </li>
                <li class="nav-item" >
                    <a class="nav-link docViewItem" aria-current="page" href="#">[Get] xxxxxxxxxxxx <span class="docViewClose">{{ SVG "x-square-fill" 16 16 }}</span></a>
                </li>
            </ul>
              <div id="doc" style="width: 100%; height: calc(100vh - 136px);background-color: #ffffff;overflow: auto;padding: 16px;position: relative;">

                <div class="row">

                    <div class="col-10">

                      <div data-bs-spy="scroll" data-bs-target="#simple-list-example" data-bs-offset="0" data-bs-smooth-scroll="true" class="scrollspy-example" style="margin-top: .5rem;overflow: auto" tabindex="0">

                          <div style="margin-bottom: 52px;margin-top: 36px;">
                            <h4 id="simple-list-item-1" style="margin-bottom: 16px;">基本信息</h4>
                            <div class="card">
                                <div class="card-body">
                                    <ul>
                                        <li style="padding: 8px;"><span style="font-size: 16px;">接口名:</span><span id="api-name" style="font-size: 21px;margin-left: 16px;"></span></li>
                                        <li style="padding: 8px;"><span style="font-size: 16px;">接口Url: </span>
                                            <span style="font-size: 21px;margin-left: 16px;">
                                                <span id="api-method" ><span class="badge rounded-pill text-bg-success" style="margin-right: 8px;">GET</span></span>
                                                <span id="api-url">asdasdaasdasdsadasdasdas</span>
                                            </span>
                                        </li>
                                        <li style="padding: 8px;">操作： <div class="btn-group" role="group" aria-label="Basic outlined example" style="margin-left: 16px;">
                                            <button type="button" class="btn btn-outline-dark" onclick="newAPIDoc('')">编辑</button>
                                            <button type="button" class="btn btn-outline-dark">请求</button>
                                            <button type="button" class="btn btn-outline-dark">分享</button>
                                            <button type="button" class="btn btn-outline-dark">Mock</button>
                                            <a type="button" class="btn btn-outline-dark" href="https://www.zhaozhongtian.top" target="_blank">在线工具</a>
                                          </div></li>
                                    </ul>
                                </div>
                            </div>
                          </div>

                        <div style="margin-bottom: 52px;">
                            <h4 id="simple-list-item-2" style="margin-bottom: 36px;">接口说明</h4>

                            <div class="card">
                                <div class="card-body" id="api-description">
                                    <p>This is some placeholder content for the scrollspy page. Note that as you scroll down the page, the appropriate navigation link is highlighted. It's repeated throughout the component example. We keep adding some more example copy here to emphasize the scrolling and highlighting.This is some placeholder content for the scrollspy page. Note that as you scroll down the page, the appropriate navigation link is highlighted. It's repeated throughout the component example. We keep adding some more example copy here to emphasize the scrolling and highlighting.</p>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 52px;">
                            <h4 id="simple-list-item-3" style="margin-bottom: 36px;">请求Header</h4>
                            <table class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th scope="col">字段</th>
                                    <th scope="col">类型</th>
                                    <th scope="col">是否必填</th>
                                    <th scope="col">描述</th>
                                    <th scope="col">示例</th>
                                </tr>
                                </thead>
                                <tbody id="api-reqHeader">
                                <tr>
                                    <td>Mark</td>
                                    <td>Mark</td>
                                    <td>Otto</td>
                                    <td>@mdo</td>
                                    <td>@mdo</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <div style="margin-bottom: 52px;">
                            <h4 id="simple-list-item-4" style="margin-bottom: 36px;">请求参数</h4>
                            <p>请求数据类型: <span id="api-reqType">json</span></p>
                            <p>示例:</p>
                            <div id="jsoneditor" style="width: 100%;margin-bottom: 16px;"></div>
                            <p>参数说明:</p>
                              <table class="table table-bordered table-light  table-hover">
                                  <thead>
                                  <tr>
                                      <th scope="col">字段</th>
                                      <th scope="col">类型</th>
                                      <th scope="col">是否为空</th>
                                      <th scope="col">描述</th>
                                      <th scope="col">示例</th>
                                  </tr>
                                  </thead>
                                  <tbody id="api-reqBodyInfo">
                                  </tbody>
                              </table>
                        </div>

                        <div style="margin-bottom: 52px;">
                            <h4 id="simple-list-item-5"  style="margin-bottom: 36px;">响应</h4>
                            <p>请求数据类型: <span id="api-respType">json</span></p>
                            <p>示例:</p>
                            <div id="jsoneditorResp" style="width: 100%;margin-bottom: 16px;"></div>
                            <p>参数说明:</p>
                            <table class="table table-bordered table-light  table-hover">
                                <thead>
                                <tr>
                                    <th scope="col">字段</th>
                                    <th scope="col">类型</th>
                                    <th scope="col">描述</th>
                                    <th scope="col">示例</th>
                                </tr>
                                </thead>
                                <tbody id="api-respBodyInfo">
                                </tbody>
                            </table>
                        </div>

                        <div style="margin-bottom: 52px;">
                            <h4 id="simple-list-item-6">日志&镜像</h4>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">admin 2024-08-13 11:11:11|  修改了文档 | 镜像: <a type="button" class="btn btn-link">sadhjsakdhkj</a> </li>
                                <li class="list-group-item">admin 2024-08-13 11:11:11|  修改了文档 | 镜像: <a type="button" class="btn btn-link">sadhjsakdhkj</a> </li>
                                <li class="list-group-item">admin 2024-08-13 11:11:11|  修改了文档 | 镜像: <a type="button" class="btn btn-link">sadhjsakdhkj</a> </li>
                                <li class="list-group-item">admin 2024-08-13 11:11:11|  修改了文档 | 镜像: <a type="button" class="btn btn-link">sadhjsakdhkj</a> </li>
                                <li class="list-group-item">admin 2024-08-13 11:11:11|  修改了文档 | 镜像: <a type="button" class="btn btn-link">sadhjsakdhkj</a> </li>
                                <li class="list-group-item">admin 2024-08-13 11:11:11|  修改了文档 | 镜像: <a type="button" class="btn btn-link">sadhjsakdhkj</a> </li>
                                <li class="list-group-item">admin 2024-08-13 11:11:11|  创建了文档 | 镜像: <a type="button" class="btn btn-link">sadhjsakdhkj</a> </li>
                            </ul>
                            </div>
                      </div>
                    </div>

                    <div class="col-2">
                        <div id="simple-list-example" class="d-flex flex-column gap-2 simple-list-example-scrollspy text-center">
                          <a class="p-1 rounded" style="color: #1a1d20;" href="#simple-list-item-1">基本信息</a>
                          <a class="p-1 rounded" style="color: #1a1d20;" href="#simple-list-item-2">接口说明</a>
                          <a class="p-1 rounded" style="color: #1a1d20;" href="#simple-list-item-3">请求Header</a>
                          <a class="p-1 rounded" style="color: #1a1d20;" href="#simple-list-item-4">请求Body</a>
                          <a class="p-1 rounded" style="color: #1a1d20;" href="#simple-list-item-5">响应</a>
                          <a class="p-1 rounded" style="color: #1a1d20;" href="#simple-list-item-6">日志&镜像</a>
                        </div>
                    </div>

                  </div>


              </div>
        </div>

        {{ template "toast" . }}
        {{ template "ProjectModalAdd" . }}
        {{ template "ApiDocAddModal" . }}
        {{ template "DocAddDirModal" . }}

    </main>

    </div>
</div>

</body>

{{ template "pubjs" . }}
<script>

    var editorAdd = {}
    var editorAddResp = {}

    var projectId = "{{ .projectId }}"
    var dirId = ""

    var editormdObj = {}

    var reqType = "json"
    var respType = "json"

    $(document).on('click', '.dir-open', function() {
        var open = $(this).attr('data-open');
        var dirid = $(this).attr('data-dirid');
        console.log($(this).find('span'))
        $(this).find('span').empty();
        if (open == 0) {
            $(this).find('span').append('{{ SVG "folder2-open" 21 21 }}');
            $(this).attr('data-open', '1');
            $('#'+dirid).show();
        } else {
            $(this).find('span').append('{{ SVG "folder" 21 21 }}');
            $(this).attr('data-open', '0');
            $('#'+dirid).hide();
        }
    });

    $(document).on('hover', '.docli', function() {
        $(this).css('background-color', '#f6f6f6');
    });

    $(document).on('mouseenter', '.hover-area', function() {
        //tooltipInit()
        $(this).find('.action-btn').show();
        $(this).css({
            'height':'72px',
        })
    }).on('mouseleave', '.hover-area', function() {
        $(this).find('.action-btn').hide();
        //$('.action-btn').fadeOut();
        $(this).css({
            'height':'38px',
        })
    });


    $(document).on('mouseenter', '.dir', function() {
        tippyInit();
        $(this).find('.dirop').show();
        $(this).css({
            'height':'72px',
        })
    }).on('mouseleave', '.dir', function() {
        $(this).find('.dirop').hide();
        $(this).css({
            'height':'42px',
        })
    });


    $(document).ready(function(){
        tippyInit();
        $('#newSort').click(function(){
            var ulValue = $( '#wrap' ).children();
            console.log(ulValue)
            for (var i=0; i<ulValue.length; i++) {
                var liValue = ulValue[i].children
                console.log(liValue)
                for(var j=0; j<liValue.length;j++) {
                    console.log(liValue[j])
                }
            }
        });


        AjaxGet("/document/dir/list?pid="+projectId, function(data){
            if (data.code === 0 ) {
                var apiDir = data.data
                for(var item in apiDir) {
                    if (apiDir.hasOwnProperty(item)){
                        var dirId = apiDir[item].dir.dirId;
                        var dirname = apiDir[item].dir.name;
                        var doc = apiDir[item].doc;
                        $("#wrap").append(dirDev(dirId, dirname))
                        $("#addDocDir").append(addDocDirOption(dirId, dirname))
                        for(var li in doc) {
                            if (doc.hasOwnProperty(li)) {
                                $("#"+dirId).append(docLi(doc[li].docId, doc[li].method, doc[li].title))
                            }
                        }
                    }
                }
            }
        });

        // create the editor
        const container = document.getElementById("jsoneditor")
        const options = {
            mode: 'view',
        }
        const editor = new JSONEditor(container, options)

        // set json
        const initialJson = {
            "Array": [1, 2, 3],
            "Boolean": true,
            "Null": null,
            "Number": 123,
            "Object": {"a": "b", "c": "d"},
            "String": "Hello World",
            "axccc": {
                "aa1":111,
                "bb2":222,
                "cccc": {
                    "ccc":333,
                    "vvv":{
                        "eee":4333
                    }
                }
            }
        }
        editor.set(initialJson)
        editor.expandAll()

        var zs = {
            "jsonpath:Array":"adasdasdasd",
            "jsonpath:Boolean": "dasdasdasd4456",
            "jsonpath:Null": "78da79s8dasd4",
            "jsonpath:Number": "sadhuiqwwb54f65s",
            "jsonpath:Object": "as54das4uhbnnasd",
            "jsonpath:String": "Hasdello234324 sda2Worsdadld",
            "jsonpath:axccc,cccc,vvv,eee": "asdasd1111111111111111"
        }

        // get json
        const updatedJson = editor.get()
        console.log(updatedJson)
        const paths = getJsonPaths(updatedJson);
        console.log(paths)

       $(".jsoneditor-field").each(function() {
        if (zs[$(this).prop("id")]){
            $(this).parent().parent().append('<td style="padding-left: 16px;color: red;font-size:12px;"> /* '+zs[$(this).prop("id")]+' */</td>')
        }
       })



        const containerAdd = document.getElementById("jsoneditorAdd")
        const optionsAdd = {
            mode: 'code',
        }
        editorAdd = new JSONEditor(containerAdd, optionsAdd)



        const containerAddResp = document.getElementById("jsoneditorAddResp")
        const optionsAddResp = {
            mode: 'code',
        }
        editorAddResp = new JSONEditor(containerAddResp, optionsAddResp)



        $('#apiDocAddModal').on('shown.bs.modal', function () {
            editormdObj = editormd("test-editor", {
                height: 440,
                width: "100%",
                path: '/js/lib/',
                htmlDecode : "style,script,iframe|on*",
                imageUpload : true,
                imageFormats : ["jpg", "jpeg", "gif", "png", "bmp"],
                imageUploadURL : "url"
                // saveHTMLToTextarea : true
            });
        });



    });

    function openBodyMain(type) {
        var bodyJson = $("#bodyJson");
        var bodyFromData = $("#bodyFromData");
        var bodyXwwwFrom = $("#bodyXwwwFrom");
        var bodyXml = $("#bodyXml");
        var bodyText = $("#bodyText");
        var bodyGo = $("#bodyGo");
        var bodyTs = $("#bodyTs");

        var openBodyBtnJson = $("#openBodyBtn-json");
        var openBodyBtnFromData = $("#openBodyBtn-from-data");
        var openBodyBtnXWwwFormUrlencoded = $("#openBodyBtn-x-www-form-urlencoded");
        var openBodyBtnXml = $("#openBodyBtn-xml")
        var openBodyBtnPlain = $("#openBodyBtn-plain")
        var openBodyBtnGo = $("#openBodyBtn-go")
        var openBodyBtnTs = $("#openBodyBtn-ts")

        bodyJson.hide();
        bodyFromData.hide();
        bodyXwwwFrom.hide();
        bodyXml.hide();
        bodyText.hide();
        bodyGo.hide();
        bodyTs.hide();

        openBodyBtnJson.removeClass('btn-light');
        if (!openBodyBtnJson.hasClass('btn-dark')) {
            openBodyBtnJson.addClass('btn-dark')
        }

        openBodyBtnFromData.removeClass('btn-light');
        if (!openBodyBtnFromData.hasClass('btn-dark')) {
            openBodyBtnFromData.addClass('btn-dark')
        }

        openBodyBtnXWwwFormUrlencoded.removeClass('btn-light');
        if (!openBodyBtnXWwwFormUrlencoded.hasClass('btn-dark')) {
            openBodyBtnXWwwFormUrlencoded.addClass('btn-dark')
        }

        openBodyBtnXml.removeClass('btn-light');
        if (!openBodyBtnXml.hasClass('btn-dark')) {
            openBodyBtnXml.addClass('btn-dark')
        }

        openBodyBtnPlain.removeClass('btn-light');
        if (!openBodyBtnPlain.hasClass('btn-dark')) {
            openBodyBtnPlain.addClass('btn-dark')
        }

        openBodyBtnGo.removeClass('btn-light');
        if (!openBodyBtnGo.hasClass('btn-dark')) {
            openBodyBtnGo.addClass('btn-dark')
        }

        openBodyBtnTs.removeClass('btn-light');
        if (!openBodyBtnTs.hasClass('btn-dark')) {
            openBodyBtnTs.addClass('btn-dark')
        }

        switch (type) {
            case 'json':
                bodyJson.show();
                openBodyBtnJson.removeClass('btn-dark');
                openBodyBtnJson.addClass('btn-light')
                reqType = "json"
                break
            case 'from-data':
                bodyFromData.show();
                openBodyBtnFromData.removeClass('btn-dark');
                openBodyBtnFromData.addClass('btn-light')
                reqType = "from-data"
                break
            case 'x-www-form-urlencoded':
                bodyXwwwFrom.show();
                openBodyBtnXWwwFormUrlencoded.removeClass('btn-dark');
                openBodyBtnXWwwFormUrlencoded.addClass('btn-light')
                reqType = "x-www-form-urlencoded"
                break
            case 'xml':
                bodyXml.show();
                openBodyBtnXml.removeClass('btn-dark');
                openBodyBtnXml.addClass('btn-light')
                reqType = "xml"
                break
            case 'plain':
                bodyText.show();
                openBodyBtnPlain.removeClass('btn-dark');
                openBodyBtnPlain.addClass('btn-light')
                reqType = "text"
                break
            case 'go':
                bodyGo.show();
                openBodyBtnGo.removeClass('btn-dark');
                openBodyBtnGo.addClass('btn-light')
                reqType = "json"
                break
            case 'ts':
                bodyTs.show();
                openBodyBtnTs.removeClass('btn-dark');
                openBodyBtnTs.addClass('btn-light')
                reqType = "json"
                break
        }
    }

    function openRespMain(type) {
        var respJson = $("#respJson")
        var respXml = $("#respXml")
        var respText = $("#respText")
        var respGo = $("#respGo");
        var respTs = $("#respTs");

        var openRespBtnJson = $("#openRespBtn-json")
        var openRespBtnXml = $("#openRespBtn-xml")
        var openRespBtnPlain = $("#openRespBtn-plain")
        var openRespBtnGo = $("#openRespBtn-go")
        var openRespBtnTs = $("#openRespBtn-ts")

        respJson.hide();
        respXml.hide();
        respText.hide();
        respGo.hide();
        respTs.hide();

        openRespBtnJson.removeClass('btn-light');
        if (!openRespBtnJson.hasClass('btn-dark')) {
            openRespBtnJson.addClass('btn-dark')
        }

        openRespBtnXml.removeClass('btn-light');
        if (!openRespBtnXml.hasClass('btn-dark')) {
            openRespBtnXml.addClass('btn-dark')
        }

        openRespBtnPlain.removeClass('btn-light');
        if (!openRespBtnPlain.hasClass('btn-dark')) {
            openRespBtnPlain.addClass('btn-dark')
        }

        openRespBtnGo.removeClass('btn-light');
        if (!openRespBtnGo.hasClass('btn-dark')) {
            openRespBtnGo.addClass('btn-dark')
        }

        openRespBtnTs.removeClass('btn-light');
        if (!openRespBtnTs.hasClass('btn-dark')) {
            openRespBtnTs.addClass('btn-dark')
        }

        switch (type) {
            case 'json':
                respJson.show();
                openRespBtnJson.removeClass('btn-dark');
                openRespBtnJson.addClass('btn-light')
                respType = "json"
                break
            case 'xml':
                respXml.show();
                openRespBtnXml.removeClass('btn-dark');
                openRespBtnXml.addClass('btn-light')
                respType = "xml"
                break
            case 'plain':
                respText.show();
                openRespBtnPlain.removeClass('btn-dark');
                openRespBtnPlain.addClass('btn-light')
                respType = "text"
                break
            case 'go':
                respGo.show();
                openRespBtnGo.removeClass('btn-dark');
                openRespBtnGo.addClass('btn-light')
                respType = "json"
                break
            case 'ts':
                respTs.show();
                openRespBtnTs.removeClass('btn-dark');
                openRespBtnTs.addClass('btn-light')
                respType = "json"
                break
        }
    }

    $(document).on('click', '.headerAdd', function() {
        var tpl = '<tr>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <select class="form-select form-select-sm addDocHeaderIsRequired" style="font-size: 11px;">'+
            '                                       <option value="1">必填</option>'+
            '                                       <option value="0">非必填</option>'+
            '                                   </select>'+
            '                                </td>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderField" type="text" placeholder="字段" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <select class="form-select form-select-sm addDocHeaderVarType" style="font-size: 11px;">\n' +
            '                                        <option value="">类型</option>\n' +
            '                                        <option value="String">String</option>\n' +
            '                                        <option value="Number">Number</option>\n' +
            '                                        <option value="Integer">Integer</option>\n' +
            '                                        <option value="Float">Float</option>\n' +
            '                                        <option value="Double">Double</option>\n' +
            '                                        <option value="Bool">Bool</option>\n' +
            '                                        <option value="Array">Array</option>\n' +
            '                                        <option value="Object">Object</option>\n' +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%">\n' +
            '                                    <input class="form-control form-control-sm addDocHeaderExample" type="text" placeholder="示例" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <div class="btn-group btn-group-sm" role="group">\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm headerAdd" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm headerRemove" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                                    </div>\n' +
            '                                </td>\n' +
            '                            </tr>'

        $("#setHeaderTable").append(tpl);
    });


    $(document).on('click', '.headerRemove', function(event) {
        var target = event.target;
        var index = $(target).parents("tr").index();
        $('#setHeaderTable tr:eq('+index+')').remove();
    });


    function saveAddDoc() {
        var reqHeader = []
        var reqBodyInfo = []
        var respInfo = []

        var headerField = $('.addDocHeaderField').map(function() {
            return $(this).val();
        }).get();
        var headerIsRequired = $('.addDocHeaderIsRequired').map(function() {
            return $(this).val();
        }).get();
        var headerVarType = $('.addDocHeaderVarType').map(function() {
            return $(this).val();
        }).get();
        var headerDescription = $('.addDocHeaderDescription').map(function() {
            return $(this).val();
        }).get();
        var headerExample = $('.addDocHeaderExample').map(function() {
            return $(this).val();
        }).get();
        for (var i=0; i<headerField.length; i++) {
            console.log(headerField[i] + headerIsRequired[i] + headerVarType[i] + headerDescription[i] + headerExample[i])
            reqHeader.push({
                "field":  headerField[i],     // 字段
                "varType":  headerVarType[i],   // 类型
                "description": headerDescription[i], // 描述
                "example": headerExample[i],    // 示例
                "isRequired":  Number(headerIsRequired[i]), // 是否必填 1:必填
                "sort": i,        // 排序
            })
        }

        var reqField = $('.reqField').map(function() {
            return $(this).val();
        }).get();

        var reqDescription = $('.reqDescription').map(function() {
            return $(this).val();
        }).get();

        var reqVarType = $('.reqVarType').map(function() {
            return $(this).val();
        }).get();

        var reqExample = $('.reqExample').map(function() {
            return $(this).val();
        }).get();

        var reqIsRequired = $('.reqIsRequired').map(function() {
            return $(this).val();
        }).get();

        for (var i=0; i<reqField.length; i++) {
            console.log(reqField[i] + reqDescription[i] + reqVarType[i] + reqExample[i] + reqIsRequired[i])
            reqBodyInfo.push({
                "field": reqField[i],
                "varType":  reqVarType[i],    // 类型
                "description": reqDescription[i], // 描述
                "example":  reqExample[i],   // 示例
                "isRequired":  Number(reqIsRequired[i]), // 是否必填 1:必填
                "sort": i,        // 排序
            })
        }

        var respField = $('.respField').map(function() {
            return $(this).val();
        }).get();

        var respDescription = $('.respDescription').map(function() {
            return $(this).val();
        }).get();

        var respVarType = $('.respVarType').map(function() {
            return $(this).val();
        }).get();

        var respExample = $('.respExample').map(function() {
            return $(this).val();
        }).get();

        for (var i=0; i<respField.length; i++) {
            console.log(respField[i] + respDescription[i] + respVarType[i] + respExample[i])
            respInfo.push({
                "field":  respField[i],   // 字段
                "varType":   respVarType[i],  // 类型
                "description":  respDescription[i], // 描述
                "example":     respExample[i],  // 示例
                "sort": i,       // 排序
            })
        }

        var param = {
            "projectId": projectId,
            "dirId": $("#addDocDir").val(),
            "content": {
                "projectId": projectId,

                "name": $("#addDocName").val(),
                "url": $("#addDocUrl").val(),
                "method": $("#addDocMethod").val(),
                "description": editormdObj.getPreviewedHTML(),
                "reqHeader": reqHeader,      // 请求头 []*ReqHeaderItem
                "reqType": reqType,                  // 请求类型
                "reqBodyJson": JSON.stringify(editorAdd.get()),              // 请求参数 - json
                "reqBodyText": $("#bodyText").val(),               // 请求参数 - text
                "reqBodyXml": $("#bodyXml").val(),     // 请求参数 - xml
                "reqBodyInfo": reqBodyInfo,              // 请求参数说明   []*BodyInfoItem
                "respType": respType,
                "resp": [{
                    "tag": "成功",      // 默认 成功
                    "respType": respType, // 响应类型
                    "respBodyJson" : $("#respJson").val(),                // 请求响应 - json
                    "respBodyXml" : $("#respXml").val(),            // 请求响应 - xml
                    "respBodyText" : $("#respText").val(),                 // 请求响应 - text
                    "respBodyInfo": respInfo, // 响应参数说明
                }],
            }
        }


        console.log("参数")
        console.log(param)

        AjaxPost("/document/create", param, function (data){
            console.log(data)
            ToastShow(data.msg);
            if (data.code === 0) {
                setTimeout(function() {
                    location.reload();
                }, 1000);
            }
        });


    }

    function addReqTpl(field, fieldType, example) {
        var fieldVal = ""
        if (field !== "") {
            fieldVal  = 'value="'+field+'"'
        }

        var stringTypeVal = '<option value="string">String</option>'
        var numberTypeVal = '<option value="number">Number</option>'
        var booleanTypeVal = '<option value="boolean">Boolean</option>'
        var arrayTypeVal = '<option value="array">Array</option>'
        var objectTypeVal = '<option value="object">Object</option>'


        switch (fieldType){
            case "string":
                stringTypeVal = '<option value="string" selected>String</option>'
                break
            case "number":
                numberTypeVal = '<option value="number" selected>Number</option>'
                break
            case "boolean":
                booleanTypeVal = '<option value="boolean" selected>Boolean</option>'
                break
            case "array":
                arrayTypeVal = '<option value="array" selected>Array</option>'
                break
            case "object":
                objectTypeVal = '<option value="object" selected>Object</option>'
                break
        }

        var reqExample = ""
        if (fieldType === "string") {
            example = removeHtmlTags(example)
        }
        if (example !== "") {
            reqExample = 'value="'+example+'"'
        }

        var tpl = '<tr>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm reqField" type="text" placeholder="字段" '+ fieldVal +' style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 25%;">\n' +
            '                                    <input class="form-control form-control-sm reqDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%">\n' +
            '                                    <select class="form-select form-select-sm reqVarType" style="font-size: 11px;">\n' +
            '                                        <option value="">类型</option>\n' + stringTypeVal + numberTypeVal + booleanTypeVal + arrayTypeVal + objectTypeVal +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%;">'+
            '                                   <input class="form-control form-control-sm reqExample" type="text" placeholder="示例" '+ reqExample +' style="font-size: 11px;">'+
            '                                </td>'+
            '                                <td style="width: 10%;">\n' +
            '                                    <select class="form-select form-select-sm reqIsRequired" style="font-size: 11px;">\n' +
            '                                        <option value="1">不为空</option>\n' +
            '                                        <option value="0">可为空</option>\n' +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <div class="btn-group btn-group-sm" role="group">\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm addReq" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm removeReq" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                                    </div>\n' +
            '                                </td>\n' +
            '                            </tr>';

        return tpl
    }

    function jsonToBodyInfoItem(jsonObj, parentKey) {
        var jsonInfo = jsonObj

        var reqField = $('.reqField').map(function() {
            return $(this).val();
        }).get();

        var reqVarType = $('.reqVarType').map(function() {
            return $(this).val();
        }).get();

        var reqExample =  $('.reqExample').map(function() {
            return $(this).val();
        }).get();

        for (var key in jsonInfo) {

            var keyType = typeof jsonInfo[key]
            if (keyType === "object") {
                keyType = isArrayOrObject(jsonInfo[key])
            }
            if (keyType === "string" && jsonInfo[key].length > 188) {
                jsonInfo[key] = jsonInfo[key].substring(0,188)+"..."
            }
            var flag = false
            for (var has in reqField) {
                if (reqField[has] === key) {
                    if (reqVarType[has] !== keyType) {
                        $('.reqVarType:eq('+has+')').val(keyType);
                    }
                    if (reqExample[has] !== jsonInfo[key]) {
                        $('.reqExample:eq('+has+')').val(jsonInfo[key]);
                    }
                    flag = true
                }
            }
            var field = key
            if (parentKey !== "") {
                field = parentKey+"."+key
            }

            if (!flag && reqField[0] === "") {
                $(".reqField").first().val(field);
                $(".reqVarType").first().val(keyType);
                $(".reqExample").first().val(jsonInfo[key]);
            } else if (!flag) {
                $("#setReqTable").append(addReqTpl(field, keyType, jsonInfo[key]));
            }

            if (keyType === "object") {
                if(parentKey === "") {
                    parentKey = key
                } else {
                    parentKey = parentKey + "."+key
                }
                jsonToBodyInfoItem(jsonInfo[key], parentKey)
            }

            if (keyType === "array") {
                if (isArrayOrObject(jsonInfo[key][0]) === "object") {
                    if(parentKey === "") {
                        parentKey = key
                    } else {
                        parentKey = parentKey + "."+key
                    }
                    jsonToBodyInfoItem(jsonInfo[key][0], parentKey)
                }
            }
        }
    }

    function jsonToBodyInfo() {
        var jsonInfo = editorAdd.get();

        jsonToBodyInfoItem(jsonInfo, "")
    }

    $(document).on('click', '.addReq', function() {
        $("#setReqTable").append(addReqTpl("", "", ""));
    });

    $(document).on('click', '.removeReq', function(event) {
        var target = event.target;
        var index = $(target).parents("tr").index();
        $('#setReqTable tr:eq('+index+')').remove();
    });

    function addRespTpl(field, fieldType, example) {
        var fieldVal = ""
        if (field !== "") {
            fieldVal  = 'value="'+field+'"'
        }

        var stringTypeVal = '<option value="string">String</option>'
        var numberTypeVal = '<option value="number">Number</option>'
        var booleanTypeVal = '<option value="boolean">Boolean</option>'
        var arrayTypeVal = '<option value="array">Array</option>'
        var objectTypeVal = '<option value="object">Object</option>'


        switch (fieldType){
            case "string":
                stringTypeVal = '<option value="string" selected>String</option>'
                break
            case "number":
                numberTypeVal = '<option value="number" selected>Number</option>'
                break
            case "boolean":
                booleanTypeVal = '<option value="boolean" selected>Boolean</option>'
                break
            case "array":
                arrayTypeVal = '<option value="array" selected>Array</option>'
                break
            case "object":
                objectTypeVal = '<option value="object" selected>Object</option>'
                break
        }

        var reqExample = ""
        if (fieldType === "string") {
            example = removeHtmlTags(example)
        }
        if (example !== "") {
            reqExample = 'value="'+example+'"'
        }

        var tpl = '<tr>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm respField" type="text" placeholder="字段" '+ fieldVal +' style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%;">\n' +
            '                                    <input class="form-control form-control-sm respDescription" type="text" placeholder="描述" style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%">\n' +
            '                                    <select class="form-select form-select-sm respVarType" style="font-size: 11px;">\n' +
            '                                        <option value="">类型</option>\n' + stringTypeVal + numberTypeVal + booleanTypeVal + arrayTypeVal + objectTypeVal +
            '                                    </select>\n' +
            '                                </td>\n' +
            '                                <td style="width: 20%">\n' +
            '                                    <input class="form-control form-control-sm respExample" type="text" placeholder="返回值" '+ reqExample +' style="font-size: 11px;">\n' +
            '                                </td>\n' +
            '                                <td style="width: 10%;">\n' +
            '                                    <div class="btn-group btn-group-sm" role="group">\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm addResp" data-bs-toggle="tooltip" data-bs-title="增加行">{{ SVG "plus-lg" 14 14 }}</a>\n' +
            '                                        <a type="button" class="btn btn-outline-dark btn-sm removeResp" data-bs-toggle="tooltip" data-bs-title="删除当前行">{{ SVG "trash-fill" 14 14 }}</a>\n' +
            '                                    </div>\n' +
            '                                </td>\n' +
            '                            </tr>'

        return tpl
    }

    function jsonToRespInfoItem(jsonObj, parentKey) {
        var jsonInfo = jsonObj

        var reqField = $('.respField').map(function() {
            return $(this).val();
        }).get();

        var reqVarType = $('.respVarType').map(function() {
            return $(this).val();
        }).get();

        var reqExample =  $('.respExample').map(function() {
            return $(this).val();
        }).get();

        for (var key in jsonInfo) {
            console.log(key+ "  -> "+ jsonInfo[key])
            var keyType = typeof jsonInfo[key]
            if (keyType === "object") {
                keyType = isArrayOrObject(jsonInfo[key])
            }
            if (keyType === "string" && jsonInfo[key].length > 188) {
                jsonInfo[key] = jsonInfo[key].substring(0,188)+"..."
            }
            var flag = false
            for (var has in reqField) {
                if (reqField[has] === key) {
                    if (reqVarType[has] !== keyType) {
                        $('.respVarType:eq('+has+')').val(keyType);
                    }
                    if (reqExample[has] !== jsonInfo[key]) {
                        $('.respExample:eq('+has+')').val(jsonInfo[key]);
                    }
                    flag = true
                }
            }

            var field = key
            if (parentKey !== "") {
                field = parentKey+"."+key
            }

            if (!flag && reqField[0] === "") {
                $(".respField").first().val(field);
                $(".respVarType").first().val(keyType);
                $(".respExample").first().val(jsonInfo[key]);
            } else if (!flag) {
                $("#setRespTable").append(addRespTpl(field, keyType, jsonInfo[key]));
            }

            if (keyType === "object") {
                if(parentKey === "") {
                    parentKey = key
                } else {
                    parentKey = parentKey + "."+key
                }
                jsonToRespInfoItem(jsonInfo[key], parentKey)
            }

            if (keyType === "array") {
                if (isArrayOrObject(jsonInfo[key][0]) === "object") {
                    if(parentKey === "") {
                        parentKey = key
                    } else {
                        parentKey = parentKey + "."+key
                    }
                    jsonToBodyInfoItem(jsonInfo[key][0], parentKey)
                }
            }
        }
    }

    function jsonToRespInfo() {
        var jsonInfo = editorAddResp.get();
        jsonToRespInfoItem(jsonInfo, "")
    }

    $(document).on('click', '.addResp', function (){
        $("#setRespTable").append(addRespTpl("", "", ""));
    });

    $(document).on('click', '.removeResp', function(event) {
        var target = event.target;
        var index = $(target).parents("tr").index();
        $('#setRespTable tr:eq('+index+')').remove();
    })

    $(document).on('click', '.docli', function(event) {
        var docId = $(this).prop('id');
        console.log(docId);

        // 获取文档
        var param = {
            "pid": projectId,
            "docId": docId,
        }
        AjaxPost("/document/item", param, function(data){
            console.log(data)
            if (data.code === 0 ) {
                loadApiDoc(data.data)
            }
        })

        var docViewTable =  $("#docViewTable")
        docViewTable.find('a').each(function() {
            $(this).removeClass("active")
        });

        var tpl = '<li class="nav-item" >\n' +
            '<a class="nav-link docViewItem active" aria-current="page" href="#">[Get] xxxxxxxxxxxx <span class="docViewClose">{{ SVG "x-square-fill" 16 16 }}</span></a>\n' +
            '</li>'

        $("#docViewTable").append(tpl);

        //const left = $('#docViewTable').width();
        $('#docViewTable').scrollLeft(9999);
    })

    $(document).on('click', '.docViewItem', function (event){
        var docViewTable =  $("#docViewTable")
        docViewTable.find('a').each(function() {
            $(this).removeClass("active")
        });

        $(this).addClass("active")

    })

    $(document).on('click', '.docViewClose', function (event){
        event.stopPropagation();
        var target = event.target;
        var index = $(target).parents("li").index();
        var now = $('#docViewTable li:eq('+index+')')
        console.log(now.find("a").hasClass("active"))
        if(now.find("a").hasClass("active")) {
            if (index>0) {
                var i = index-1
                $('#docViewTable li:eq('+i+')').find("a").addClass("active")
            }else {
                var i = index+1
                $('#docViewTable li:eq('+i+')').find("a").addClass("active")
            }
        }
        now.remove();
    })

    function openAddDocDir() {
        $('#docAddDirModal').modal('show');
    }

    function addDocDir() {
        const url = "/document/dir/create"
        var param = {
            "pid": projectId,
            "dirName": $("#docAddDirName").val()
        }
        AjaxPost(url, param, function (data){
            console.log(data)

            ToastShow(data.msg);

            if (data.code === 0) {
                setTimeout(function() {
                    location.reload();
                }, 1000);
            }

        })
    }

    function loadApiDoc(apiDoc) {
        var apiName = $("#api-name")
        var apiMethod = $("#api-method")
        var apiUrl = $("#api-url")
        var apiDescription = $("#api-description")
        var apiReqHeader = $("#api-reqHeader")
        var apiReqType = $("#api-reqType")
        var apiReqBodyInfo = $("#api-reqBodyInfo")
        var apiRespType = $("#api-respType")
        var apiRespBodyInfo = $("#api-respBodyInfo")

        apiName.empty();
        apiMethod.empty();
        apiUrl.empty();
        apiDescription.empty();
        apiReqHeader.empty();
        apiReqType.empty();
        apiReqBodyInfo.empty();
        apiRespType.empty();
        apiRespBodyInfo.empty();

        apiName.append(apiDoc.name);
        apiMethod.append(apiDoc.method);
        apiUrl.append(apiDoc.url);
        apiDescription.html(apiDoc.description);
        apiReqHeader.append(apiDoc.reqHeader);
        apiReqType.append(apiDoc.reqType);
        apiReqBodyInfo.append(apiDoc.reqBodyInfo);
        apiRespType.append(apiDoc.respType);
        apiRespBodyInfo.append(apiDoc.respBodyInfo);
    }

</script>
{{ template "end" . }}